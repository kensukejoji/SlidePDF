<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JOLLYGOOD スライドライブラリ</title>
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16.png">
    <link rel="apple-touch-icon" href="favicon.png">

    <!-- OGP tags -->
    <meta property="og:title" content="JOLLYGOOD スライドライブラリ">
    <meta property="og:description" content="VR医療教育の漫画風スライド資料をご覧いただけます。臨床現場で使える教育コンテンツを多数掲載。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jollygood.co.jp/slide/">
    <meta property="og:image" content="https://jollygood.co.jp/slide/ogp.png">
    <meta property="og:site_name" content="JOLLYGOOD">
    <meta property="og:locale" content="ja_JP">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="JOLLYGOOD スライドライブラリ">
    <meta name="twitter:description" content="VR医療教育の漫画風スライド資料をご覧いただけます">
    <meta name="twitter:image" content="https://jollygood.co.jp/slide/ogp.png">

    <link rel="stylesheet" href="styles.css?v=9">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1 class="logo">
                <span class="logo-icon">📚</span>
                JOLLYGOOD スライドライブラリ
            </h1>
            <nav class="nav">
                <div id="userInfo" class="user-info hidden">
                    <img id="userAvatar" class="user-avatar" alt="">
                    <span id="userName"></span>
                    <button id="logoutBtn" class="logout-btn">ログアウト</button>
                </div>
                <!-- Manual Login Button -->
                <!-- Google Sign-In Button Container -->
                <div id="googleBtnContainer" class="google-btn-container" style="display: none;"></div>
                <button id="adminBtn" class="nav-btn">
                    <span>⚙️</span> 管理
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Library Grid -->
        <section id="library" class="library">
            <div class="library-header">
                <h2>スライドライブラリ</h2>
                <p class="subtitle">クリックしてスライドを表示</p>
            </div>

            <!-- Search and Filter Section -->
            <div class="search-filter-section">
                <div class="search-box">
                    <span class="search-icon">🔍</span>
                    <input type="text" id="searchInput" class="search-input" placeholder="キーワードで検索...">
                    <button id="clearSearchBtn" class="clear-search-btn" style="display: none;">✕</button>
                </div>
                <div id="tagCloud" class="tag-cloud">
                    <!-- Tags will be dynamically inserted here -->
                </div>
            </div>
            <div id="pdfGrid" class="pdf-grid">
                <!-- PDF cards will be dynamically inserted here -->
            </div>
        </section>
    </main>

    <!-- PDF Viewer Modal -->
    <div id="viewerModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="viewer-container">
            <!-- Viewer Header -->
            <div class="viewer-header">
                <h3 id="viewerTitle" class="viewer-title">PDF Title</h3>

                <button id="watchVideoBtn" class="watch-video-btn hidden">
                    <span class="play-icon">▶</span> 動画で見る
                </button>

                <div class="viewer-actions">
                    <button id="likeBtn" class="action-btn like-btn" title="いいね">
                        <span class="like-icon">♡</span>
                        <span id="likeCount" class="like-count">0</span>
                    </button>
                    <button id="shareUrlBtn" class="action-btn" title="URLをコピー">
                        <span>🔗</span>
                    </button>
                    <button id="embedCodeBtn" class="action-btn" title="埋め込みコードをコピー">
                        <span>📋</span>
                    </button>
                    <button id="downloadBtn" class="action-btn" title="ダウンロード">
                        <span>⬇️</span>
                    </button>
                    <button id="adminEditBtn" class="action-btn admin-only" title="編集" style="display: none;">
                        <span>⚙️</span>
                    </button>
                    <button id="fullscreenBtn" class="action-btn" title="全画面">
                        <span>⛶</span>
                    </button>
                    <button id="closeViewerBtn" class="action-btn close-btn" title="閉じる">
                        <span>✕</span>
                    </button>
                </div>
            </div>

            <!-- Viewer Body -->
            <div class="viewer-body">
                <!-- PDF Canvas Area -->
                <div class="canvas-wrapper">
                    <canvas id="pdfCanvas"></canvas>
                </div>

                <!-- PDF Info Sidebar -->
                <aside id="pdfInfoSidebar" class="pdf-info-sidebar">
                    <div class="info-section">
                        <h4>概要</h4>
                        <p id="pdfDescription">-</p>
                    </div>
                    <div class="info-section">
                        <h4>関連サービス</h4>
                        <ul id="relatedServices" class="link-list">
                            <!-- Links will be inserted dynamically -->
                        </ul>
                    </div>
                    <div class="info-section">
                        <h4>関連公募事業</h4>
                        <ul id="relatedPrograms" class="link-list">
                            <!-- Links will be inserted dynamically -->
                        </ul>
                    </div>
                    <div class="info-section">
                        <h4>備考</h4>
                        <p id="pdfNotes">-</p>
                    </div>
                </aside>
                </aside>

                <!-- Video Player Container (Overlay) -->
                <div id="videoContainer" class="video-container hidden">
                    <button id="closeVideoBtn" class="close-video-btn" title="動画を閉じてスライドに戻る">
                        <span>✕</span> 動画を閉じる
                    </button>
                    <div class="video-wrapper">
                        <iframe id="videoPlayer" src="" frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen></iframe>
                    </div>
                </div>
            </div>

            <!-- Viewer Controls -->
            <div class="viewer-controls">
                <button id="prevPageBtn" class="control-btn">
                    <span>◀</span> 前へ
                </button>
                <div class="page-indicator">
                    <span id="currentPage">1</span> / <span id="totalPages">1</span>
                </div>
                <button id="nextPageBtn" class="control-btn">
                    次へ <span>▶</span>
                </button>
                <div class="zoom-controls">
                    <label>ズーム:</label>
                    <input type="range" id="zoomSlider" min="50" max="200" value="100">
                    <span id="zoomValue">100%</span>
                </div>
            </div>

            <!-- CTA Section (shown at end of slides) -->
            <div id="ctaSection" class="cta-section hidden">
                <button id="closeCTABtn" class="close-cta-btn" title="閉じる">✕</button>
                <div class="cta-content">
                    <h3>🎉 ご覧いただきありがとうございます</h3>
                    <p>お気軽にご相談ください。</p>
                    <div class="cta-links">
                        <a href="https://jollygoodplus.com/" target="_blank" class="cta-btn primary">
                            JOLLYGOOD+へ
                        </a>
                        <a href="https://lp.jollygoodplus.com/member/" target="_blank" class="cta-btn secondary">
                            アプリで無料体験
                        </a>
                    </div>
                    <div class="cta-contact">
                        <a href="https://jollygood.eeasy.jp/soudan" target="_blank" class="cta-btn outline">
                            📅 面談予約はこちら
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="adminModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="admin-container">
            <div class="admin-header">
                <h2>⚙️ 管理画面</h2>
                <button id="closeAdminBtn" class="action-btn close-btn">
                    <span>✕</span>
                </button>
            </div>
            <div class="admin-body">
                <!-- Add New PDF (Compact) -->
                <div class="upload-compact">
                    <input type="file" id="newPdfInput" accept=".pdf" class="file-input">
                    <label for="newPdfInput" class="file-label-compact">
                        📤 PDFを追加
                    </label>
                    <span id="selectedFileName" class="selected-file-name"></span>
                    <button id="uploadPdfBtn" class="upload-btn-compact" style="display: none;">
                        アップロード
                    </button>
                    <div id="uploadProgress" class="upload-progress" style="display: none;">
                        <div class="progress-bar">
                            <div id="progressFill" class="progress-fill"></div>
                        </div>
                        <span id="progressText">0%</span>
                    </div>
                    <button id="regenerateAllOgpBtn" class="file-label-compact" style="background: #059669;">
                        🔄 全OGP生成
                    </button>
                </div>

                <!-- PDF List -->
                <div class="admin-section">
                    <h3>PDF一覧</h3>
                    <div id="adminPdfList" class="admin-pdf-list">
                        <!-- PDF items will be inserted here -->
                    </div>
                </div>
            </div>
        </div>


    </div>
    </div>
    </div>

    <!-- PDF Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="edit-container">
            <div class="edit-header">
                <h2>📝 PDF情報編集</h2>
                <button id="closeEditBtn" class="action-btn close-btn">
                    <span>✕</span>
                </button>
            </div>
            <div class="edit-body">
                <input type="hidden" id="editPdfId">

                <div class="form-group">
                    <label>
                        タイトル
                        <button id="generateAiTitleBtn" type="button" class="ai-generate-btn" title="AIで自動生成">
                            ✨ AIで生成
                        </button>
                    </label>
                    <input type="text" id="editTitle" class="form-input" placeholder="15文字以内の簡潔なタイトル">
                </div>

                <div class="form-group">
                    <label>
                        概要・説明文
                        <button id="generateAiSummaryBtn" type="button" class="ai-generate-btn" title="AIで自動生成">
                            ✨ AIで生成
                        </button>
                    </label>
                    <textarea id="editDescription" class="form-textarea" rows="3"
                        placeholder="スライドの内容を簡潔に説明してください。AIで自動生成することもできます。"></textarea>
                </div>

                <div class="form-group">
                    <label>関連サービスURL（改行区切り）</label>
                    <textarea id="editServices" class="form-textarea" rows="3"
                        placeholder="https://example.com/service1&#10;https://example.com/service2"></textarea>
                </div>

                <div class="form-group">
                    <label>関連公募事業URL（改行区切り）</label>
                    <textarea id="editPrograms" class="form-textarea" rows="3"
                        placeholder="https://www.example.go.jp/program1"></textarea>
                </div>

                <div class="form-group">
                    <label>備考</label>
                    <textarea id="editNotes" class="form-textarea" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>動画URL (YouTube/Shorts)</label>
                    <input type="text" id="editVideoUrl" class="form-input"
                        placeholder="https://www.youtube.com/watch?v=... または https://youtube.com/shorts/...">
                </div>

                <div class="form-group">
                    <label>OGP画像用ページを選択</label>
                    <div id="ogpPageSelector" class="ogp-page-selector">
                        <!-- Page thumbnails will be inserted here -->
                    </div>
                    <button id="downloadOgpBtn" class="save-btn"
                        style="margin-top: 1rem; width: auto; background: #10b981;">
                        📥 選択ページをOGP画像としてダウンロード
                    </button>
                </div>

                <div class="edit-actions">
                    <button id="saveEditBtn" class="save-btn">保存</button>
                    <button id="cancelEditBtn" class="cancel-btn">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
        <span id="toastMessage"></span>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <ul class="footer-links">
                <li><a href="https://jollygood.co.jp/" target="_blank">ホーム</a></li>
                <li><a href="https://jollygoodplus.com/" target="_blank">JOLLYGOOD+</a></li>
                <li><a href="https://jollygood.co.jp/vrdtx/" target="_blank">VR DTx</a></li>
                <li><a href="https://jollygood.co.jp/robotready/" target="_blank">JG Robot Ready</a></li>
                <li><a href="https://multimodal-ai.tech/" target="_blank">マルチモーダルAIラボ</a></li>
                <li><a href="https://jollygood.co.jp/vrimpact/" target="_blank">特許・実証効果</a></li>
            </ul>
            <div class="copyright">
                &copy; JOLLYGOOD Inc.
            </div>
        </div>
    </footer>

    <script src="app.js?v=9"></script>
</body>

</html>